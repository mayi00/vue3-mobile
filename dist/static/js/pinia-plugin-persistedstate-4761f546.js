function e(e,r){var t;return e="object"==typeof(t=e)&&null!==t?e:Object.create(null),new Proxy(e,{get:(e,t,o)=>Reflect.get(e,t,o)||Reflect.get(r,t,o)})}function r(e,r,t,o){try{const s=null==r?void 0:r.getItem(o);s&&e.$patch(null==t?void 0:t.deserialize(s))}catch(s){}}var t=function(t={}){return o=>{const{options:{persist:s},store:n}=o;if(!s)return;const a=(Array.isArray(s)?s.map((r=>e(r,t))):[e(s,t)]).map((({storage:e=localStorage,beforeRestore:r=null,afterRestore:t=null,serializer:o={serialize:JSON.stringify,deserialize:JSON.parse},key:s=n.$id,paths:a=null})=>({storage:e,beforeRestore:r,afterRestore:t,serializer:o,key:s,paths:a})));a.forEach((e=>{const{storage:t,serializer:s,key:a,paths:l,beforeRestore:i,afterRestore:c}=e;null==i||i(o),r(n,t,s,a),null==c||c(o),n.$subscribe(((e,r)=>{try{const e=Array.isArray(l)?function(e,r){return r.reduce(((r,t)=>{const o=t.split(".");return function(e,r,t){return r.slice(0,-1).reduce(((e,r)=>/^(__proto__)$/.test(r)?{}:e[r]=e[r]||{}),e)[r[r.length-1]]=t,e}(r,o,function(e,r){return r.reduce(((e,r)=>null==e?void 0:e[r]),e)}(e,o))}),{})}(r,l):r;t.setItem(a,s.serialize(e))}catch(o){}}),{detached:!0})})),n.$hydrate=({runHooks:e=!0}={})=>{a.forEach((t=>{const{beforeRestore:s,afterRestore:a,storage:l,serializer:i,key:c}=t;e&&(null==s||s(o)),r(n,l,i,c),e&&(null==a||a(o))}))}}}();export{t as s};
